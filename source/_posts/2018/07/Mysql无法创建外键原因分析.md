---
title: Mysql无法创建外键原因分析
date: 2018-07-19 09:56:27
tags: 
    - Mysql
---

> 喜欢就去追，一直干等着，你能等来什么？

有其在新手使用 Mysql 创建外键时经常会遇到问题，导致无法成功创建外键。感觉外键非常难创建，其实是因为在创建 Mysql 外键的时候有很多细节没有注意到，现在总结下创建外键需要注意的细节。

<!-- more -->

我们会从数据表到字段每个细节一层层分析，哪些细节问题没注意到。

# 原因分析

1、数据表的引擎导致，若想要使用外键约束，表必须是 InnoDB 引擎。数据表有一个或者两个表是 MyISAM 引擎的表。（实际上，如果两个表都是 MyISAM 引擎，根本无法产生外键，只会建立索引）。

2、要设置外键的字段没有建立起索引，或不是 primary key（主键）。如果创建外键的字段不是 primary key ，就必须先为它创建一个索引。

3、两个字段的类型或者大小必须一致。例如，字段主键是 int(10)，那么外键也必须设置成 int(10)。另外，你还必须确定两个字段是否都为 signed 或 unsigned（即：无符号），这两字段必须严格地一致匹配

4、外键字段名字重复，数据库外键名必须唯一。检查数据库以确保外健名字是唯一的，可以在键名后面加上几个随机的字符以测试是否是这个原因。

5、相关字段设置了 NOTS NULL ，然而外键定义却设置 ON DELETE SET NULL。可通过修改 cascade 的属性值或者把字段属性设置成 null 来解决。

6、字符集 (Charset)和 排序规则 (Collate) 选项在表级和字段级上必须一致。例如，最常见的就是两个表一个是 utf8,另一个是 utf8mb4。

7、外键设置了默认值。例如，外键设置了 DEFAULT 0。

8、ALTER 添加外键声明中有语法错误。

`ALTER TABLE 子表的数据表名 ADD FOREIGN KEY(子表的外键名称) REFERENCES 父表的数据表名称(父表的主键名称);`