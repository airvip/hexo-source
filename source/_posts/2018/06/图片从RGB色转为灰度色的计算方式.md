---
title: 图片从RGB色转为灰度色的计算方式
date: 2018-06-01 12:22:23
tags: 
    - 图像处理
---

> 温柔解救不了这个世界。

三原色光模式(RGB color model)，又称RGB颜色模型或红绿蓝颜色模型，是一种加色模型，将红（Red）、绿（Green）、蓝（Blue）三原色的色光以不同的比例相加，以产生多种多样的色光。玩过PS的小伙伴肯定知道我们在处理图片的时候是需要在指定颜色模式下操作的，常见的如 RGB，CMYK，灰度...

<!-- more -->

正常情况下，人眼对绿色的敏感度最高，对红色敏感度次之，对蓝色的敏感度最低，因此我们只需要适当调整RGB色的权重，我们就可以得到我们想要的灰度图像。

经过前人大量的实验与论证，我们得到下面一个公式

``` bash
Gray = R*0.299 + G*0.587 + B*0.114
```

# 应用实践

想必大家都知道，浮点运算是非常消耗资源的，我们在实际应用中，一张图像存在几十万的像素都是很正常不过的，所以我们就要考虑转浮点运算为整数运算。
通过上面的公式不难发现，我们的权重系数都是三位精度的数字，我们可以使用缩放1000倍的方法来实现整数运算

``` bash
Gray = (R*299 + G*587 + B*114) / 1000
```

我们通过这种整数运算可以极大的提高运行速度，但还有一点就是最后的除法运算。移位比出发快得多，我们可以将系数缩放成 2 的整数幂。

以16位精度(2的16次幂是65536)确定每个权重系数值

``` bash
R的系数 = 0.299 * 65536 = 19595.264 ≈ 19595 # 直接省去 0.264
G的系数 = 0.587 * 65536 + (0.264) = 38469.632 + 0.264= 38469.896 ≈ 38469 # 直接省去 0.896
B的系数 = 0.114 * 65536 + (0.896) =  7471.104 +0.896 = 7472
```

我们使用的是去尾法。因为四舍五入会有较大的误差，应该将以前的计算结果的误差一起计算进去。

最终我们得到计算灰度表达式

``` bash
Gray = (R*19595 + G*38469 + B*7472)>> 16
```

# 2-20位精度的表达式

``` bash
Gray = (R*1 + G*2 + B*1) >> 2 再优化 Gray = (R + (WORD)G<<1 + B) >>2
Gray = (R*2 + G*5 + B*1) >> 3
Gray = (R*4 + G*10 + B*2) >> 4
Gray = (R*9 + G*19 + B*4) >> 5
Gray = (R*19 + G*37 + B*8) >> 6
Gray = (R*38 + G*75 + B*15) >> 7
Gray = (R*76 + G*150 + B*30) >> 8
Gray = (R*153 + G*300 + B*59) >> 9
Gray = (R*306 + G*601 + B*117) >> 10
Gray = (R*612 + G*1202 + B*234) >> 11
Gray = (R*1224 + G*2405 + B*467) >>12
Gray = (R*2449 + G*4809 + B*934) >>13
Gray = (R*4898 + G*9618 + B*1868) >>14
Gray = (R*9797 + G*19235 + B*3736) >>15
Gray = (R*19595 + G*38469 + B*7472)>> 16
Gray = (R*39190 + G*76939 + B*14943)>> 17
Gray = (R*78381 + G*153878 + B*29885)>> 18
Gray = (R*156762 + G*307757 + B*59769)>> 19
Gray = (R*313524 + G*615514 + B*119538)>> 20
```

通过上面公式，不难发现：3与4、7与8、10与11、13与14、19与20 是一样的

参考博客 

* [从RGB色转为灰度色算法](https://blog.csdn.net/xdrt81y/article/details/8289963)