---
title: Linux 之root用户的远程登录
date: 2017-02-19 16:20:05
tags:
    - Linux
---

> 异地恋是，尝过欣喜若狂，也知道失魂落魄。

在 Linux 中有个神一般的存在，那就是 root 用户，如果在服务器上没能很好的对 root 用户加以管理，很有可能造成严重的后果。所以对 root 用户的严格管理是非常必要的。

<!-- more -->

在 linux 的发行版中，root 用户默认是没有启用的，这也是出于安全的考虑。

切换用户
``` bash
$ su 用户名 #之后输入密码就进入切换的账户了
```

# 启用 root 用户

因为 root 用户默认是存在，我们只需要为 root 用户设置密码，我们就可以切换到 root 用户了
``` bash
$ sudo passwd root #之后就可以设置root的密码了
```

在生产中我们一般是不给 root 用户设置密码的，那现在要删除 root 的密码应该怎么操作呢？操作如下
``` bash
$ sudo passwd -d root
```

我们执行上述命令对应操作的是 `/etc/shadow` 文件
```
root::17190:0:99999:7:::
```
账户名:密码:最近更改密码日期:密码不可更改天数:密码需重新变更天数:密码需要变更期限前的警告期限:密码过期的期限:账号失效的期限:保留

说明:
* 账户名:由于密码也需要与帐号对应,因此,这个文件的第一栏就是帐号，必须要与 /etc/passwd 相同才行！
* 密码:这个是真正的密码，而且是经过加密过的密码！ 注意：虽然这些加密过的密码很难被解出来，但是‘很难’不等于‘不会’，所以，这个档案的预设属性是‘-rw-------’或者是‘-r--------’，即只有 root 才可以读写就是！需注意，不要不小心更动了这个文件的属性！另外， 如果是在密码栏的第一个字元为``*`或者`!`，表示这个帐号并不会被用来登录。 
* 最近更改密码日期:这个栏位记录了‘更改密码的那一天’的日期， 因为计算 Linux 日期的时间是以1970年1月1日作为 1 ，所以我这个日期可以理解为距离 1970年1月1日有多少天。
* 密码不可更改天数:意思是这个帐号的密码需要经过几天才可以被变更！如果是 0 ，表示密码随时可以更动的意思。这个限制是为了怕密码被某些人一改再改而设计的！如果设定为 10 天的话，那么当你设定了密码之后， 10 天之内都无法改变这个密码！
* 密码需重新变更天数:由于害怕密码被窃取而危害到整个系统的安全，所以设计了这个栏位。 你必须要在这个时间之内重新设定你的密码，否则这个帐号将会暂时失效。 而如果像上面的 99999 的话，那就表示，密码不需要重新输入！不过，如果是为了安全性，最好可以设定一段时间之后，要求使用者变更密码！
* 密码需要变更期限前的警告期限:当帐号的密码失效期限快要到的时候， 就是前面字段设置的‘必须变更密码’的时间， 系统会依据这个栏位的设定，发出‘警告’信息给这个帐号，提醒他‘再过 n 天你的密码就要失效了，请尽快重新设定你的密码！’，如上面的例子，则是密码到期之前的 7 天之内，系统会警告该用户。
* 密码过期的期限:如果用户过了警告期限没有重新输入密码， 密码就失效了，也就是说，你在‘必须变更密码的期限前，并没有变更你的密码！’ 那么该密码就称为‘失效的密码’怎么办呢？没关系，还有这个栏位的天数设计， 意思就是说，当密码失效后，你还可以用这个密码在 n 天内进行登录。 而如果在这个天数后还是没有变更密码，那么您的帐号就失效了！无法登入！
* 账号失效的期限:这个日期跟第三栏一样，都是使用1970年以后的总日数设定。这个栏位表示： 这个帐号在此栏位规定的日期之后，将无法再使用。 这个栏位会被使用通常应该是在‘收费服务’的系统中（如：我们购买的云服务器）， 你可以规定一个日期让该帐号不能再使用！
* 保留:最后一个栏位是保留的，等待以后新功能加入。

# root远程登录设置

下面的操作都是在 root 账户模式下操作的

查看服务器 sshd 的配置
``` bash
$ cat /etc/ssh/ssd_config
```
我们看到有这么一句话
`PermitRootLogin prohibit-password` 意思是允许root登录，但是禁止root用密码登录

那就是可以使用 `秘钥` 登录，我们可以尝试一下

查看root账户下存不存在 .ssh 目录
``` bash
$ whoami #表明我是root用户
root
$ pwd #我当前在在目录
/root
$ ls -al #没有发现 .ssh 目录
$ mkdir .ssh #创建 .ssh 目录
```
查看 .ssh 目录中有没有 authorized_keys 文件。

如果不存在 ，创建 authorized_keys 文件并写入 **需要连接服务器的计算机** 的公钥，关于公钥的创建不做过多爱说明
``` bash
$ cd .ssh/  #进入 .ssh 目录
$ touch authorized_keys  #创建 authorized_keys 文件
$ vim authorized_keys  #写入本地计算机的公钥
```
![写入本地计算机的公钥](https://s3.ax1x.com/2021/01/13/sNZHk4.png)

在本地机器上测试链接远程服务器
![测试链接远程服务器](https://s3.ax1x.com/2021/01/13/sNZT7F.png)

# 禁用root远程登录

其实在生产中我们一般是不允许root用户进行远程登录，那现在要禁用root远程登录该怎么办呢？
其实很简单，只需要我们稍微修改下 `/etc/ssd/ssd_config` 文件即可
修改结果如下
``` 
# Authentication:
LoginGraceTime 120
#PermitRootLogin prohibit-password  #将该行注释掉，即：在行首添加'#'号
PermitRootLogin no  #新增该行
StrictModes yes
``` 

记住：修改完保存后需要重新载入 sshd 配置文件,配置才会生效
``` bash
$ systemctl reload sshd
```

如果不想让任何用户使用密码进行远程登录，可以进行如下修改,
``` 
# Change to no to disable tunnelled clear text passwords
#PasswordAuthentication yes
PasswordAuthentication no
```
记住：重新载入 sshd 配置文件
这样将更加安全，即便是我们普通用户的密码泄露了，如果服务器上没有配置在用户的目录下配置自动验证秘钥，也是无法登录我们服务器的。








